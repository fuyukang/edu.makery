
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>JavaFX 2 Tutorial Part V - Storing Data as XML - edu.makery.ch</title>
  <meta name="author" content="Marco Jakob">

  
  <meta name="description" content="Topics in Part V Persisting data as XML
Using the JavaFX FileChooser
Using the JavaFX Menu
Saving the last opened file path in user preferences &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://edu.makery.ch/blog/2012/11/27/javafx-tutorial-addressapp-5/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/edu-makery" rel="alternate" title="edu.makery.ch" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34917397-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">edu.makery.ch</a></h1>
  
    <h2>Education in the Making.</h2>
  
</hgroup>

</header>
  <nav role="navigation">
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:edu.makery.ch" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Blog Archives</a></li>
  <li><a href="/learn-java">Learn Java</a></li>
  <li><a href="/learn-javafx">Learn JavaFX</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">JavaFX 2 Tutorial Part V - Storing Data as XML</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-27T22:00:00+01:00" pubdate data-updated="true">Nov 27<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><img src="/images/javafx-addressapp/part-5/addressapp01.png"></p>

<h2>Topics in Part V</h2>

<ul>
<li><strong>Persisting data as XML</strong></li>
<li>Using the JavaFX <strong>FileChooser</strong></li>
<li>Using the JavaFX <strong>Menu</strong></li>
<li>Saving the last opened file path in <strong>user preferences</strong></li>
</ul>


<!-- more -->


<h3>Other Tutorial Parts</h3>

<ul>
<li><a href="/blog/2012/11/16/javafx-tutorial-addressapp-1">Part I - Scene Builder</a></li>
<li><a href="/blog/2012/11/17/javafx-tutorial-addressapp-2">Part II - Model and TableView</a></li>
<li><a href="/blog/2012/11/20/javafx-tutorial-addressapp-3">Part III - Interacting with the User</a></li>
<li><a href="/blog/2012/11/26/javafx-tutorial-addressapp-4">Part IV - CSS Styling</a></li>
<li><strong>Part V - Storing Data as XML</strong></li>
<li><a href="/blog/2012/12/04/javafx-tutorial-addressapp-6">Part VI - Statistics Chart</a></li>
<li><a href="/blog/2012/12/18/javafx-tutorial-addressapp-7">Part VII - Deployment with e(fx)clipse</a></li>
</ul>


<h2>Saving User Preferences</h2>

<p>Java allows us to save some application state using a class called <code>Preferences</code>. Depending on the operating system, the <code>Preferences</code> are saved in different places (e.g. the registry file in Windows).</p>

<p>We won&#8217;t be able to use <code>Preferences</code> to store our entire address book. But it allows us to save some simple application state. One such thing is the path to the <em>last opened file</em>. With this information we could load the last application state whenever the user restarts the application.</p>

<p>The following two methods take care of saving and retrieving Preferences. Add them to the end of your <code>MainApp</code> class.</p>

<figure class='code'><figcaption><span>MainApp.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Returns the person file preference, i.e. the file that was last opened.</span>
</span><span class='line'><span class="cm"> * The preference is read from the OS specific registry. If no such</span>
</span><span class='line'><span class="cm"> * preference can be found, null is returned.</span>
</span><span class='line'><span class="cm"> * </span>
</span><span class='line'><span class="cm"> * @return</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="n">File</span> <span class="nf">getPersonFilePath</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">Preferences</span> <span class="n">prefs</span> <span class="o">=</span> <span class="n">Preferences</span><span class="o">.</span><span class="na">userNodeForPackage</span><span class="o">(</span><span class="n">MainApp</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>  <span class="n">String</span> <span class="n">filePath</span> <span class="o">=</span> <span class="n">prefs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;filePath&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">(</span><span class="n">filePath</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">filePath</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Sets the file path of the currently loaded file.</span>
</span><span class='line'><span class="cm"> * The path is persisted in the OS specific registry.</span>
</span><span class='line'><span class="cm"> * </span>
</span><span class='line'><span class="cm"> * @param file the file or null to remove the path</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPersonFilePath</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">Preferences</span> <span class="n">prefs</span> <span class="o">=</span> <span class="n">Preferences</span><span class="o">.</span><span class="na">userNodeForPackage</span><span class="o">(</span><span class="n">MainApp</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">(</span><span class="n">file</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">prefs</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;filePath&quot;</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">getPath</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Update the stage title</span>
</span><span class='line'>    <span class="n">primaryStage</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;AddressApp - &quot;</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span><span class='line'>  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">prefs</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="s">&quot;filePath&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Update the stage title</span>
</span><span class='line'>    <span class="n">primaryStage</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;AddressApp&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Persisting Data as XML</h2>

<p>At the moment our address application&#8217;s data only resides in memory. Every time we close the application, the data is lost. So it&#8217;s about time to start thinking persistently storing data.</p>

<h3>Why XML?</h3>

<p>One of the most common ways to persist data is using a database. Databases usually contain some kind of relational data (like tables) while the data we need to save are objects. This is called the <a href="http://wikipedia.org/wiki/Object-relational_impedance_mismatch">object-relational impedance mismatch</a>. It is quite some work to match objects to relational database tables. There are some of frameworks that help with the matching (e.g. <a href="http://www.hibernate.org/">Hibernate</a>, the most popular one) but it still requires quite some work to set up.</p>

<p>For our simple data model it&#8217;s much easier to use XML. We&#8217;ll use a library called <a href="http://xstream.codehaus.org/">XStream</a>. With just a few lines of code this will allow us to generate XML output like this:</p>

<figure class='code'><figcaption><span>sample.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;list&gt;</span>
</span><span class='line'>  <span class="nt">&lt;person&gt;</span>
</span><span class='line'>    <span class="nt">&lt;firstName&gt;</span>Hans<span class="nt">&lt;/firstName&gt;</span>
</span><span class='line'>    <span class="nt">&lt;lastName&gt;</span>Muster<span class="nt">&lt;/lastName&gt;</span>
</span><span class='line'>    <span class="nt">&lt;street&gt;</span>some street<span class="nt">&lt;/street&gt;</span>
</span><span class='line'>    <span class="nt">&lt;postalCode&gt;</span>1234<span class="nt">&lt;/postalCode&gt;</span>
</span><span class='line'>    <span class="nt">&lt;city&gt;</span>some city<span class="nt">&lt;/city&gt;</span>
</span><span class='line'>    <span class="nt">&lt;birthday&gt;</span>
</span><span class='line'>      <span class="nt">&lt;time&gt;</span>1354035227734<span class="nt">&lt;/time&gt;</span>
</span><span class='line'>      <span class="nt">&lt;timezone&gt;</span>Europe/Berlin<span class="nt">&lt;/timezone&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/birthday&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/person&gt;</span>
</span><span class='line'>  <span class="nt">&lt;person&gt;</span>
</span><span class='line'>    <span class="nt">&lt;firstName&gt;</span>Anna<span class="nt">&lt;/firstName&gt;</span>
</span><span class='line'>    <span class="nt">&lt;lastName&gt;</span>Best<span class="nt">&lt;/lastName&gt;</span>
</span><span class='line'>    <span class="nt">&lt;street&gt;</span>some street<span class="nt">&lt;/street&gt;</span>
</span><span class='line'>    <span class="nt">&lt;postalCode&gt;</span>1234<span class="nt">&lt;/postalCode&gt;</span>
</span><span class='line'>    <span class="nt">&lt;city&gt;</span>some city<span class="nt">&lt;/city&gt;</span>
</span><span class='line'>    <span class="nt">&lt;birthday&gt;</span>
</span><span class='line'>      <span class="nt">&lt;time&gt;</span>1354035227734<span class="nt">&lt;/time&gt;</span>
</span><span class='line'>      <span class="nt">&lt;timezone&gt;</span>Europe/Berlin<span class="nt">&lt;/timezone&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/birthday&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/person&gt;</span>
</span><span class='line'><span class="nt">&lt;/list&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Reading and Writing Files</h3>

<p>Since Java 7 there are some convenient classes to deal with reading and writing files. For a detailed tutorial see Oracle&#8217;s <a href="http://docs.oracle.com/javase/tutorial/essential/io/fileio.html">File I/O Tutorial</a>.</p>

<p>Since we might need to read/write files in different places of our application we&#8217;ll create a handy <code>FileUtil</code> helper class. This class provides one static method for reading from a file and one for writing to a file. Copy the following file into the <code>ch.makery.util</code> package:</p>

<figure class='code'><figcaption><span> (FileUtil.java)</span> <a href='/downloads/javafx-addressapp/part-5/FileUtil.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">ch</span><span class="o">.</span><span class="na">makery</span><span class="o">.</span><span class="na">address</span><span class="o">.</span><span class="na">util</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.BufferedWriter</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.nio.charset.Charset</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.nio.file.Files</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Helper class for reading and writing files.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileUtil</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">  * The character set. UTF-8 works good for windows, mac and Umlaute.</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Charset</span> <span class="n">CHARSET</span> <span class="o">=</span> <span class="n">Charset</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">  * Reads the specified file and returns the content as a String.</span>
</span><span class='line'><span class="cm">  * </span>
</span><span class='line'><span class="cm">  * @param file</span>
</span><span class='line'><span class="cm">  * @return</span>
</span><span class='line'><span class="cm">  * @throws IOException thrown if an I/O error occurs opening the file</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">readFile</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">StringBuffer</span> <span class="n">stringBuffer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">newBufferedReader</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">toPath</span><span class="o">(),</span> <span class="n">CHARSET</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">String</span> <span class="n">line</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>      <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">stringBuffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  
</span><span class='line'>      <span class="n">reader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>  
</span><span class='line'>      <span class="k">return</span> <span class="n">stringBuffer</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">  * Saves the content String to the specified file.</span>
</span><span class='line'><span class="cm">  * </span>
</span><span class='line'><span class="cm">  * @param content</span>
</span><span class='line'><span class="cm">  * @param file</span>
</span><span class='line'><span class="cm">  * @throws IOException thrown if an I/O error occurs opening or creating the file</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">saveFile</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">,</span> <span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">BufferedWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">newBufferedWriter</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">toPath</span><span class="o">(),</span> <span class="n">CHARSET</span><span class="o">);</span>
</span><span class='line'>      <span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">content</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">content</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
</span><span class='line'>      <span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Using XStream</h3>

<p>To use XStream we need three libraries. Add the following libraries to the project&#8217;s <em>lib</em> folder and add them to the build path (right click on libraries).</p>

<ul>
<li><a href="/downloads/javafx-addressapp/part-5/xstream-1.4.3.jar">xstream-1.4.3.jar</a> - XStream main library</li>
<li><a href="/downloads/javafx-addressapp/part-5/xmlpull-1.1.3.1.jar">xmlpull-1.1.3.1.jar</a> - XmlPull to detect available parsers</li>
<li><a href="/downloads/javafx-addressapp/part-5/xpp3_min-1.1.4c.jar">xpp3_min-1.1.4c.jar</a> - Xpp3, a fast pull parser</li>
</ul>


<p>You can also download the three libraries from the <a href="http://xstream.codehaus.org/download.html">XStream download page</a>.</p>

<p>We&#8217;ll make our <code>MainApp</code> class responsible for reading and writing the person data. Add the following two methods to the end of <code>MainApp.java</code>:</p>

<figure class='code'><figcaption><span>MainApp.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Loads person data from the specified file. The current person data will</span>
</span><span class='line'><span class="cm"> * be replaced.</span>
</span><span class='line'><span class="cm"> * </span>
</span><span class='line'><span class="cm"> * @param file</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&quot;unchecked&quot;</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">loadPersonDataFromFile</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">XStream</span> <span class="n">xstream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XStream</span><span class="o">();</span>
</span><span class='line'>  <span class="n">xstream</span><span class="o">.</span><span class="na">alias</span><span class="o">(</span><span class="s">&quot;person&quot;</span><span class="o">,</span> <span class="n">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">xml</span> <span class="o">=</span> <span class="n">FileUtil</span><span class="o">.</span><span class="na">readFile</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">personList</span> <span class="o">=</span> <span class="o">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;)</span> <span class="n">xstream</span><span class="o">.</span><span class="na">fromXML</span><span class="o">(</span><span class="n">xml</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">personData</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
</span><span class='line'>    <span class="n">personData</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">personList</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">setPersonFilePath</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// catches ANY exception</span>
</span><span class='line'>    <span class="n">Dialogs</span><span class="o">.</span><span class="na">showErrorDialog</span><span class="o">(</span><span class="n">primaryStage</span><span class="o">,</span>
</span><span class='line'>        <span class="s">&quot;Could not load data from file:\n&quot;</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="na">getPath</span><span class="o">(),</span>
</span><span class='line'>        <span class="s">&quot;Could not load data&quot;</span><span class="o">,</span> <span class="s">&quot;Error&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Saves the current person data to the specified file.</span>
</span><span class='line'><span class="cm"> * </span>
</span><span class='line'><span class="cm"> * @param file</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">savePersonDataToFile</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">XStream</span> <span class="n">xstream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XStream</span><span class="o">();</span>
</span><span class='line'>  <span class="n">xstream</span><span class="o">.</span><span class="na">alias</span><span class="o">(</span><span class="s">&quot;person&quot;</span><span class="o">,</span> <span class="n">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Convert ObservableList to a normal ArrayList</span>
</span><span class='line'>  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">personList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">personData</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">String</span> <span class="n">xml</span> <span class="o">=</span> <span class="n">xstream</span><span class="o">.</span><span class="na">toXML</span><span class="o">(</span><span class="n">personList</span><span class="o">);</span>
</span><span class='line'>  <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">FileUtil</span><span class="o">.</span><span class="na">saveFile</span><span class="o">(</span><span class="n">xml</span><span class="o">,</span> <span class="n">file</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">setPersonFilePath</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// catches ANY exception</span>
</span><span class='line'>    <span class="n">Dialogs</span><span class="o">.</span><span class="na">showErrorDialog</span><span class="o">(</span><span class="n">primaryStage</span><span class="o">,</span>
</span><span class='line'>        <span class="s">&quot;Could not save data to file:\n&quot;</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="na">getPath</span><span class="o">(),</span>
</span><span class='line'>        <span class="s">&quot;Could not save data&quot;</span><span class="o">,</span> <span class="s">&quot;Error&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The save method uses <code>xstream.toXML(...)</code> to convert the list of <code>Person</code> objects into an XML representation. The load method uses <code>xstream.fromXML(...)</code> to convert the xml data back to a list of <code>Person</code>s.</p>

<p>If anything goes wrong, an error dialog is presented to the user.</p>

<h2>Handling Menu Actions</h2>

<p>In our <code>RootLayout.fxml</code> there is already a menu, but we haven&#8217;t used it yet. Before we add action to the menu we&#8217;ll first create all menu items.</p>

<p>Open the <code>RootLayout.fxml</code> file in Scene Builder and drag the necessary menu items from the <em>library view</em> to the menu bar in the <em>hierarchy view</em>. Create a <strong>New</strong>, <strong>Open&#8230;</strong>, <strong>Save</strong>, <strong>Save As&#8230;</strong>, and <strong>Exit</strong> menu item. You may also use separators between some items.</p>

<p><img src="/images/javafx-addressapp/part-5/addressapp02.png"></p>

<p>Hint: Using the <em>Accelerator</em> setting under properties you can set shortcut keys to menu items.</p>

<h3>The RootLayoutController</h3>

<p>For handling menu actions we&#8217;ll need a new controller class. Create a class <code>RootLayoutController</code> inside the controller package <code>ch.makery.address</code>.</p>

<p>Add the following content to the controller:</p>

<figure class='code'><figcaption><span> (RootLayoutController.java)</span> <a href='/downloads/javafx-addressapp/part-5/RootLayoutController.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">ch</span><span class="o">.</span><span class="na">makery</span><span class="o">.</span><span class="na">address</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">javafx.fxml.FXML</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javafx.scene.control.Dialogs</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javafx.stage.FileChooser</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * The controller for the root layout. The root layout provides the basic</span>
</span><span class='line'><span class="cm"> * application layout containing a menu bar and space where other JavaFX</span>
</span><span class='line'><span class="cm"> * elements can be placed.</span>
</span><span class='line'><span class="cm"> * </span>
</span><span class='line'><span class="cm"> * @author Marco Jakob</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RootLayoutController</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Reference to the main application</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">MainApp</span> <span class="n">mainApp</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">  * Is called by the main application to give a reference back to itself.</span>
</span><span class='line'><span class="cm">  * </span>
</span><span class='line'><span class="cm">  * @param mainApp</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMainApp</span><span class="o">(</span><span class="n">MainApp</span> <span class="n">mainApp</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">mainApp</span> <span class="o">=</span> <span class="n">mainApp</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">  * Creates an empty address book.</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="nd">@FXML</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleNew</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mainApp</span><span class="o">.</span><span class="na">getPersonData</span><span class="o">().</span><span class="na">clear</span><span class="o">();</span>
</span><span class='line'>      <span class="n">mainApp</span><span class="o">.</span><span class="na">setPersonFilePath</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">  * Opens a FileChooser to let the user select an address book to load.</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="nd">@FXML</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleOpen</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">FileChooser</span> <span class="n">fileChooser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileChooser</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Set extension filter</span>
</span><span class='line'>      <span class="n">FileChooser</span><span class="o">.</span><span class="na">ExtensionFilter</span> <span class="n">extFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileChooser</span><span class="o">.</span><span class="na">ExtensionFilter</span><span class="o">(</span>
</span><span class='line'>              <span class="s">&quot;XML files (*.xml)&quot;</span><span class="o">,</span> <span class="s">&quot;*.xml&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">fileChooser</span><span class="o">.</span><span class="na">getExtensionFilters</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">extFilter</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Show save file dialog</span>
</span><span class='line'>      <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="n">fileChooser</span><span class="o">.</span><span class="na">showOpenDialog</span><span class="o">(</span><span class="n">mainApp</span><span class="o">.</span><span class="na">getPrimaryStage</span><span class="o">());</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">file</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">mainApp</span><span class="o">.</span><span class="na">loadPersonDataFromFile</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">  * Saves the file to the person file that is currently open. If there is no</span>
</span><span class='line'><span class="cm">  * open file, the &quot;save as&quot; dialog is shown.</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="nd">@FXML</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleSave</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">File</span> <span class="n">personFile</span> <span class="o">=</span> <span class="n">mainApp</span><span class="o">.</span><span class="na">getPersonFilePath</span><span class="o">();</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">personFile</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">mainApp</span><span class="o">.</span><span class="na">savePersonDataToFile</span><span class="o">(</span><span class="n">personFile</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">handleSaveAs</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">  * Opens a FileChooser to let the user select a file to save to.</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="nd">@FXML</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleSaveAs</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">FileChooser</span> <span class="n">fileChooser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileChooser</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Set extension filter</span>
</span><span class='line'>      <span class="n">FileChooser</span><span class="o">.</span><span class="na">ExtensionFilter</span> <span class="n">extFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileChooser</span><span class="o">.</span><span class="na">ExtensionFilter</span><span class="o">(</span>
</span><span class='line'>              <span class="s">&quot;XML files (*.xml)&quot;</span><span class="o">,</span> <span class="s">&quot;*.xml&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">fileChooser</span><span class="o">.</span><span class="na">getExtensionFilters</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">extFilter</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Show save file dialog</span>
</span><span class='line'>    <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="n">fileChooser</span><span class="o">.</span><span class="na">showSaveDialog</span><span class="o">(</span><span class="n">mainApp</span><span class="o">.</span><span class="na">getPrimaryStage</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">file</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="c1">// Make sure it has the correct extension</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">getPath</span><span class="o">().</span><span class="na">endsWith</span><span class="o">(</span><span class="s">&quot;.xml&quot;</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getPath</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;.xml&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="n">mainApp</span><span class="o">.</span><span class="na">savePersonDataToFile</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">  * Opens an about dialog.</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="nd">@FXML</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleAbout</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Dialogs</span><span class="o">.</span><span class="na">showInformationDialog</span><span class="o">(</span><span class="n">mainApp</span><span class="o">.</span><span class="na">getPrimaryStage</span><span class="o">(),</span> <span class="s">&quot;Author: Marco Jakob\nWebsite: http://edu.makery.ch&quot;</span><span class="o">,</span> <span class="s">&quot;AddressApp&quot;</span><span class="o">,</span> <span class="s">&quot;About&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">  * Closes the application.</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="nd">@FXML</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleExit</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The controller contains an <code>@FXML</code> method for each menu item.</p>

<h4>FileChooser</h4>

<p>Take note of the methods that use the <code>FileChooser</code> class inside <code>RootLayoutController</code> above. First, a new object of the class <code>FileChooser</code> is created. Then, an extension filter is added so that only files ending in <code>.xml</code> are displayed. Finally, the file chooser is displayed on top of the primary stage.</p>

<p>If the user closes the dialog without choosing a file, <code>null</code> is returned. Otherwise, we get the selected file and we can pass it to the <code>loadPersonDataFromFile(...)</code> or <code>savePersonDataToFile(...)</code> method of <code>MainApp</code>.</p>

<h3>Connecting the fxml View to the Controller</h3>

<ol>
<li><p>Open <code>RootLayout.fxml</code> in Scene Builder. Select the root <code>BorderPane</code>. In the Code view select the <code>RootLayoutController</code> as Controller class.</p></li>
<li><p>Select each menu item in the Hierarchy view. In the Code view under <em>On Action</em> you should see a choice of all the <code>@FXML</code> methods of the controller. Choose the corresponding method for each menu item. <br/>
<img src="/images/javafx-addressapp/part-5/addressapp03.png"> <br/>
<strong>If you don&#8217;t see the choices in On Action:</strong> Because of a bug in the <em>Developer Preview of Scene Builder 1.1</em> you have to remove the controller from the root, hit enter, and add it again. I had to do this after every restart of Scene Builder!</p></li>
<li><p>Close Scene Builder and hit <strong>Refresh (F5)</strong> on your project&#8217;s root folder. This will make Eclipse aware of the changes you made in Scene Builder.</p></li>
</ol>


<h3>Connecting the MainApp and RootLayoutController</h3>

<p>In several places, the <code>RootLayoutController</code> needs a reference back to the <code>MainApp</code>. We haven&#8217;t passed the reference to the <code>RootLayoutController</code> yet.</p>

<p>So, open the <code>MainApp</code> class and replace the <code>start(...)</code> method with the following code:</p>

<figure class='code'><figcaption><span>MainApp.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">(</span><span class="n">Stage</span> <span class="n">primaryStage</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">primaryStage</span> <span class="o">=</span> <span class="n">primaryStage</span><span class="o">;</span>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">primaryStage</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;AddressApp&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">primaryStage</span><span class="o">.</span><span class="na">getIcons</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Image</span><span class="o">(</span><span class="s">&quot;file:resources/images/address_book_32.png&quot;</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">// Load the root layout from the fxml file</span>
</span><span class='line'>    <span class="n">FXMLLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FXMLLoader</span><span class="o">(</span><span class="n">MainApp</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getResource</span><span class="o">(</span><span class="s">&quot;view/RootLayout.fxml&quot;</span><span class="o">));</span>
</span><span class='line'>    <span class="n">rootLayout</span> <span class="o">=</span> <span class="o">(</span><span class="n">BorderPane</span><span class="o">)</span> <span class="n">loader</span><span class="o">.</span><span class="na">load</span><span class="o">();</span>
</span><span class='line'>    <span class="n">Scene</span> <span class="n">scene</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scene</span><span class="o">(</span><span class="n">rootLayout</span><span class="o">);</span>
</span><span class='line'>    <span class="n">primaryStage</span><span class="o">.</span><span class="na">setScene</span><span class="o">(</span><span class="n">scene</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Give the controller access to the main app</span>
</span><span class='line'>    <span class="n">RootLayoutController</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="na">getController</span><span class="o">();</span>
</span><span class='line'>    <span class="n">controller</span><span class="o">.</span><span class="na">setMainApp</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">primaryStage</span><span class="o">.</span><span class="na">show</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">// Exception gets thrown if the fxml file could not be loaded</span>
</span><span class='line'>    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">showPersonOverview</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Try to load last opened person file</span>
</span><span class='line'>  <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="n">getPersonFilePath</span><span class="o">();</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">(</span><span class="n">file</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">loadPersonDataFromFile</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice the two changes: The lines that <em>give the controller access to the main app</em> and the last three lines to <em>load the last opened person file</em>.</p>

<h2>How It Works</h2>

<p>Doing a test drive of your application you should be able to use the menus to save the person data to a file and load it again. After a restart, it should automatically load the last used file.</p>

<p>Let&#8217;s see how it all works together:</p>

<ol>
<li>The application is started using the <code>main(...)</code> method inside <code>MainApp</code>.</li>
<li>The constructor <code>public MainApp()</code> is called and adds some sample data.</li>
<li><code>MainApp</code>s <code>start(...)</code> method is called and initializes the root layout from <code>RootLayout.fxml</code>. The fxml file has the information about which controller to use and links the view to its <code>RootLayoutController</code>.</li>
<li>The <code>MainApp</code> gets the <code>RootLayoutController</code> from the fxml loader and passes a reference to itself to the controller. With this reference the controller can later access the (public) methods of <code>MainApp</code>.</li>
<li>At the end of the <code>start(...)</code> method we try to get the <em>last opened person file</em> from <code>Preferences</code>. If the <code>Preferences</code> know about such an XML file, we&#8217;ll load the data from this XML file. This will apparently overwrite the sample data from the constructor.</li>
</ol>


<hr />

<h3>What&#8217;s Next?</h3>

<p>In Tutorial <a href="/blog/2012/12/04/javafx-tutorial-addressapp-6">Part VI</a> we&#8217;ll add a birthday statistics chart.</p>

<h3>Download</h3>

<p><a href="/downloads/javafx-addressapp/part-5/addressapp-part-5.zip">Source of Tutorial Part V</a> as Eclipse Project.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Marco Jakob</span></span>

      








  


<time datetime="2012-11-27T22:00:00+01:00" pubdate data-updated="true">Nov 27<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/english/'>English</a>, <a class='category' href='/blog/categories/javafx/'>JavaFX</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://edu.makery.ch/blog/2012/11/27/javafx-tutorial-addressapp-5/" data-via="marcojkob" data-counturl="http://edu.makery.ch/blog/2012/11/27/javafx-tutorial-addressapp-5/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/11/26/javafx-tutorial-addressapp-4/" title="Previous Post: JavaFX 2 Tutorial Part IV - CSS Styling">&laquo; JavaFX 2 Tutorial Part IV - CSS Styling</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/12/04/javafx-tutorial-addressapp-6/" title="Next Post: JavaFX 2 Tutorial Part VI - Statistics Chart">JavaFX 2 Tutorial Part VI - Statistics Chart &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/01/07/javafx-date-picker/">JavaFX Date Picker</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/04/javafx-snapshot-as-png-image/">JavaFX Snapshot as PNG Image</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/19/javafx-event-handlers-and-change-listeners/">JavaFX Event Handlers and Change Listeners</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/19/javafx-tableview-cell-renderer/">JavaFX TableView Cell Renderer</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/18/javafx-tableview-filter/">JavaFX TableView Filter</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/18/new-java-and-javafx-learn-pages/">New Java and JavaFX Learn Pages</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/18/javafx-tutorial-addressapp-7/">JavaFX 2 Tutorial Part VII - Deployment with e(fx)clipse</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/13/helpful-java-libraries/">Helpful Java Libraries</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/'>All (20)</a><a title='subscribe via RSS' href='http://feeds.feedburner.com/edu-makery' class='feed-rss_16 category-icon'></a></li>
<li class='category'><a href='/blog/categories/deutsch/'>Deutsch (1)</a><a title='subscribe via RSS: Deutsch' href='http://feeds.feedburner.com/edu-makery-deutsch' class='feed-rss_16 category-icon'></a></li>
<li class='category'><a href='/blog/categories/english/'>English (19)</a><a title='subscribe via RSS: English' href='http://feeds.feedburner.com/edu-makery-english' class='feed-rss_16 category-icon'></a></li>
<li class='category'><a href='/blog/categories/java/'>Java (5)</a><a title='subscribe via RSS: Java' href='http://feeds.feedburner.com/edu-makery-java' class='feed-rss_16 category-icon'></a></li>
<li class='category'><a href='/blog/categories/javafx/'>JavaFX (14)</a><a title='subscribe via RSS: JavaFX' href='http://feeds.feedburner.com/edu-makery-javafx' class='feed-rss_16 category-icon'></a></li>

  </ul>
</section>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Marco Jakob - 
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> - 
  <span class="credit">Icons by <a href="http://glyphicons.com">glyphicons</a> and <a href="http://www.icondrawer.com">icondrawer</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'edumakery';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://edu.makery.ch/blog/2012/11/27/javafx-tutorial-addressapp-5/';
        var disqus_url = 'http://edu.makery.ch/blog/2012/11/27/javafx-tutorial-addressapp-5/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
